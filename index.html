<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAN & Passport Photo Software - ‡Æ§‡Ææ‡Æ∏‡Øç ‡Æ™‡Øä‡Æ§‡ØÅ ‡Æö‡Øá‡Æµ‡Øà ‡ÆÆ‡Øà‡ÆØ‡ÆÆ‡Øç</title>
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --success: #2e7d32;
            --danger: #c62828;
            --warning: #f57c00;
            --light: #f5f5f5;
            --dark: #0d47a1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px 30px;
            position: relative;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5em;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .company-name {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .certification {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            text-align: center;
            margin-top: 10px;
        }
        
        .contact-info {
            text-align: right;
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: rgba(0,0,0,0.1);
            border-radius: 8px;
            padding: 5px;
            margin-top: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            color: var(--primary);
        }
        
        .main-content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* PAN Tool Styles */
        .provider-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .provider-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .provider-card.active {
            border-color: var(--success);
            background: #e8f5e9;
        }
        
        .provider-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .specs {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .image-processing {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 992px) {
            .image-processing {
                grid-template-columns: 1fr;
            }
        }
        
        .image-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
        }
        
        .image-preview {
            width: 100%;
            height: 250px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin: 15px 0;
            background: #f8f9fa;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .controls-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            padding: 10px;
            background: var(--light);
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            color: var(--dark);
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
        }
        
        .dimension-display {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        .dimension-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .process-btn {
            width: 100%;
            padding: 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .process-btn:hover {
            background: #1b5e20;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
        }
        
        /* Passport Tool Styles */
        .passport-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .passport-container {
                grid-template-columns: 1fr;
            }
        }
        
        .photo-editor {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .editor-preview {
            width: 100%;
            height: 300px;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        .editor-preview canvas {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .background-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .bg-color {
            width: 100%;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .bg-color.active {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .adjustment-slider {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .slider-label span {
            font-weight: bold;
            color: var(--dark);
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }
        
        .border-controls {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .sheet-preview {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .sheet-canvas-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: auto;
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
        }
        
        .sheet-canvas-container canvas {
            display: block;
            margin: 0 auto;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .sheet-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 25px;
            margin-top: 40px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
            }
        }
        
        .address-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .contact-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .logo-section {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .controls-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo">
                    <span class="logo-icon">üì∑</span>
                    <div>
                        <div class="company-name">PAN & Passport Photo Software</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">‡Æ§‡Ææ‡Æ∏‡Øç ‡Æ™‡Øä‡Æ§‡ØÅ ‡Æö‡Øá‡Æµ‡Øà ‡ÆÆ‡Øà‡ÆØ‡ÆÆ‡Øç</div>
                    </div>
                </div>
                <div class="contact-info">
                    <div style="font-weight: bold;">üìû 98 43 23 23 24</div>
                    <div>üìû 88 70 23 23 32 | üìû 95 85 33 43 65</div>
                </div>
            </div>
            
            <div class="certification">
                ‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Ææ‡Æ®‡Æø‡Æ≤ ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡ÆÖ‡Æô‡Øç‡Æï‡ØÄ‡Æï‡Ææ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('pan')">üìá PAN Card Tool</button>
                <button class="tab" onclick="switchTab('passport')">üõÇ Passport Photo Tool</button>
            </div>
        </header>
        
        <div class="main-content">
            <!-- PAN Card Tool -->
            <div id="panTab" class="tab-content active">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: var(--primary);">PAN Card Photo & Signature Tool</h2>
                    <p style="color: #666; margin-top: 10px;">‡Æ§‡Øá‡Æµ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æö‡Øá‡Æµ‡Øà‡ÆØ‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ÆÆ‡Øç ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Ææ‡Æï ‡ÆÆ‡Ææ‡Æ±‡ØÅ‡ÆÆ‡Øç</p>
                </div>
                
                <!-- Provider Selection -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üè¢ PAN Provider Selection</h3>
                    <div class="provider-grid">
                        <div class="provider-card active" onclick="selectProvider('uti')" id="providerUti">
                            <h3><span>üè¶</span> UTI Infrastructure</h3>
                            <div class="specs">
                                <div class="spec-item">
                                    <span>‡Æ™‡Øã‡Æü‡Øç‡Æü‡Øã:</span>
                                    <span class="dimension-value">213√ó213 pixels</span>
                                </div>
                                <div class="spec-item">
                                    <span>DPI:</span>
                                    <span class="dimension-value">300 DPI</span>
                                </div>
                                <div class="spec-item">
                                    <span>‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ:</span>
                                    <span class="dimension-value">400√ó200 pixels</span>
                                </div>
                                <div class="spec-item">
                                    <span>DPI:</span>
                                    <span class="dimension-value">600 DPI</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="provider-card" onclick="selectProvider('nsdl')" id="providerNsdl">
                            <h3><span>üèõÔ∏è</span> NSDL e-Gov</h3>
                            <div class="specs">
                                <div class="spec-item">
                                    <span>‡Æ™‡Øã‡Æü‡Øç‡Æü‡Øã:</span>
                                    <span class="dimension-value">197√ó276 pixels</span>
                                </div>
                                <div class="spec-item">
                                    <span>DPI:</span>
                                    <span class="dimension-value">200 DPI</span>
                                </div>
                                <div class="spec-item">
                                    <span>‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ:</span>
                                    <span class="dimension-value">354√ó157 pixels</span>
                                </div>
                                <div class="spec-item">
                                    <span>DPI:</span>
                                    <span class="dimension-value">200 DPI</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="provider-card" onclick="selectProvider('esevai')" id="providerEsevai">
                            <h3><span>‚öôÔ∏è</span> ESEVAI</h3>
                            <div class="specs">
                                <div class="spec-item">
                                    <span>‡Æ™‡Øã‡Æü‡Øç‡Æü‡Øã:</span>
                                    <span class="dimension-value">250√ó250 pixels</span>
                                </div>
                                <div class="spec-item">
                                    <span>DPI:</span>
                                    <span class="dimension-value">200 DPI</span>
                                </div>
                                <div class="spec-item">
                                    <span>‡Æï‡Øà‡ÆØ‡ØÜ‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ:</span>
                                    <span class="dimension-value">Not Required</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Image Processing -->
                <div class="image-processing">
                    <!-- Photo Section -->
                    <div class="image-box">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">
                            <span>üì∑</span> PHOTO
                        </h3>
                        
                        <div class="image-preview" id="panPhotoPreview">
                            <div style="color: #999; text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 10px;">üì∏</div>
                                <div>Photo will appear here</div>
                            </div>
                        </div>
                        
                        <div class="controls-row">
                            <div class="control-btn" onclick="document.getElementById('panPhotoUpload').click()">
                                üìÅ BROWSE
                            </div>
                            <div class="control-btn" onclick="pastePanImage('photo')">
                                üìã PASTE
                            </div>
                            <div class="control-btn" onclick="clearPanImage('photo')">
                                üóëÔ∏è CLEAR
                            </div>
                        </div>
                        
                        <input type="file" id="panPhotoUpload" accept="image/*" style="display: none;" 
                               onchange="handlePanPhotoUpload(event)">
                        
                        <div class="dimension-display">
                            <div style="margin-bottom: 10px; font-weight: bold;">Current Settings:</div>
                            <div class="spec-item">
                                <span>Size:</span>
                                <span id="photoSizeDisplay" class="dimension-value">213√ó213 px</span>
                            </div>
                            <div class="spec-item">
                                <span>DPI:</span>
                                <span id="photoDpiDisplay" class="dimension-value">300 DPI</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Signature Section -->
                    <div class="image-box" id="signatureSection">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">
                            <span>üñãÔ∏è</span> SIGNATURE
                        </h3>
                        
                        <div class="image-preview" id="panSignPreview">
                            <div style="color: #999; text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 10px;">‚úçÔ∏è</div>
                                <div>Signature will appear here</div>
                            </div>
                        </div>
                        
                        <div class="controls-row">
                            <div class="control-btn" onclick="document.getElementById('panSignUpload').click()">
                                üìÅ BROWSE
                            </div>
                            <div class="control-btn" onclick="pastePanImage('sign')">
                                üìã PASTE
                            </div>
                            <div class="control-btn" onclick="clearPanImage('sign')">
                                üóëÔ∏è CLEAR
                            </div>
                        </div>
                        
                        <input type="file" id="panSignUpload" accept="image/*" style="display: none;" 
                               onchange="handlePanSignUpload(event)">
                        
                        <div class="dimension-display">
                            <div style="margin-bottom: 10px; font-weight: bold;">Current Settings:</div>
                            <div class="spec-item">
                                <span>Size:</span>
                                <span id="signSizeDisplay" class="dimension-value">400√ó200 px</span>
                            </div>
                            <div class="spec-item">
                                <span>DPI:</span>
                                <span id="signDpiDisplay" class="dimension-value">600 DPI</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Process Button -->
                <button class="process-btn" onclick="processPanImages()">
                    <span>‚ö°</span> PROCESS & DOWNLOAD PAN IMAGES
                </button>
                
                <!-- Instructions -->
                <div style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">üìã Instructions:</h4>
                    <ol style="color: #555; padding-left: 20px; line-height: 1.6;">
                        <li>‡Æö‡Øá‡Æµ‡Øà‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç (UTI, NSDL, ESEVAI)</li>
                        <li>‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç (‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æí‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç)</li>
                        <li>‡Æï‡Øà‡ÆØ‡Øä‡Æ™‡Øç‡Æ™‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç (ESEVAI ‡Æ§‡Æµ‡Æø‡Æ∞)</li>
                        <li>‡ÆÆ‡Øá‡Æ≤‡Øá ‡Æâ‡Æ≥‡Øç‡Æ≥ "PROCESS & DOWNLOAD" ‡Æ™‡Øä‡Æ§‡Øç‡Æ§‡Ææ‡Æ©‡Øà ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç</li>
                        <li>‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Ææ‡Æï ‡Æ§‡Æ∞‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÖ‡Æ≥‡Æµ‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡ÆÜ‡Æï‡ØÅ‡ÆÆ‡Øç</li>
                    </ol>
                </div>
            </div>
            
            <!-- Passport Photo Tool -->
            <div id="passportTab" class="tab-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: var(--primary);">Passport Size Photo Tool</h2>
                    <p style="color: #666; margin-top: 10px;">‡Æ™‡Øá‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æµ‡ØÅ‡Æ£‡Øç‡Æü‡ØÅ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æø 6√ó4 ‡Æá‡Æ≤‡Øç ‡ÆÖ‡Æö‡Øç‡Æö‡Æø‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ∏‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡Øç ‡Æö‡Øà‡Æ∏‡Øç ‡Æ™‡Øã‡Æü‡Øç‡Æü‡Øã</p>
                </div>
                
                <div class="passport-container">
                    <!-- Photo Editor -->
                    <div class="photo-editor">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">
                            <span>üé®</span> Photo Editor
                        </h3>
                        
                        <!-- Upload Section -->
                        <div style="margin-bottom: 20px;">
                            <input type="file" id="passportUpload" accept="image/*" style="display: none;" 
                                   onchange="handlePassportUpload(event)">
                            <div style="display: flex; gap: 10px;">
                                <button class="control-btn" onclick="document.getElementById('passportUpload').click()" 
                                        style="flex: 1;">
                                    üìÅ UPLOAD PHOTO
                                </button>
                                <button class="control-btn" onclick="pastePassportImage()" style="flex: 1;">
                                    üìã PASTE FROM CLIPBOARD
                                </button>
                            </div>
                        </div>
                        
                        <!-- Preview Canvas -->
                        <div class="editor-preview">
                            <canvas id="editorCanvas"></canvas>
                        </div>
                        
                        <!-- Background Colors -->
                        <div style="margin-top: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px; color: var(--dark);">
                                üé® Background Color:
                            </div>
                            <div class="background-options">
                                <div class="bg-color active" style="background: white;" 
                                     onclick="changeBackgroundColor('white')" data-color="white"></div>
                                <div class="bg-color" style="background: #0077be;" 
                                     onclick="changeBackgroundColor('#0077be')" data-color="#0077be"></div>
                                <div class="bg-color" style="background: #d32f2f;" 
                                     onclick="changeBackgroundColor('#d32f2f')" data-color="#d32f2f"></div>
                                <div class="bg-color" style="background: #388e3c;" 
                                     onclick="changeBackgroundColor('#388e3c')" data-color="#388e3c"></div>
                                <div class="bg-color" style="background: #ffeb3b;" 
                                     onclick="changeBackgroundColor('#ffeb3b')" data-color="#ffeb3b"></div>
                                <div class="bg-color" style="background: #212121;" 
                                     onclick="changeBackgroundColor('#212121')" data-color="#212121"></div>
                                <div class="bg-color" style="background: #f5f5f5;" 
                                     onclick="changeBackgroundColor('#f5f5f5')" data-color="#f5f5f5"></div>
                                <div class="bg-color" style="background: transparent; border: 2px dashed #999;" 
                                     onclick="changeBackgroundColor('transparent')" data-color="transparent">
                                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #666; font-size: 12px;">
                                        No BG
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Adjustments -->
                        <div style="margin-top: 25px;">
                            <div style="font-weight: bold; margin-bottom: 15px; color: var(--dark);">
                                ‚öôÔ∏è Photo Adjustments:
                            </div>
                            
                            <div class="adjustment-slider">
                                <div class="slider-label">
                                    <span>Brightness</span>
                                    <span id="brightnessValue">0%</span>
                                </div>
                                <input type="range" id="brightnessSlider" min="-100" max="100" value="0" 
                                       oninput="updateAdjustment('brightness')">
                            </div>
                            
                            <div class="adjustment-slider">
                                <div class="slider-label">
                                    <span>Contrast</span>
                                    <span id="contrastValue">0%</span>
                                </div>
                                <input type="range" id="contrastSlider" min="-100" max="100" value="0" 
                                       oninput="updateAdjustment('contrast')">
                            </div>
                            
                            <div class="adjustment-slider">
                                <div class="slider-label">
                                    <span>Saturation</span>
                                    <span id="saturationValue">0%</span>
                                </div>
                                <input type="range" id="saturationSlider" min="-100" max="100" value="0" 
                                       oninput="updateAdjustment('saturation')">
                            </div>
                        </div>
                        
                        <!-- Border Controls -->
                        <div style="margin-top: 25px;">
                            <div style="font-weight: bold; margin-bottom: 15px; color: var(--dark);">
                                üñºÔ∏è Border Settings:
                            </div>
                            
                            <div class="border-controls">
                                <div>
                                    <div class="slider-label">
                                        <span>Border Thickness</span>
                                        <span id="borderThicknessValue">0 px</span>
                                    </div>
                                    <input type="range" id="borderThicknessSlider" min="0" max="50" value="0" 
                                           oninput="updateBorder()">
                                </div>
                                <div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">Color:</div>
                                    <input type="color" id="borderColorPicker" value="#000000" 
                                           onchange="updateBorder()" style="width: 100%; height: 40px; border-radius: 5px; border: none;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reset Button -->
                        <button class="control-btn" onclick="resetAdjustments()" style="width: 100%; margin-top: 20px;">
                            üîÑ RESET ALL ADJUSTMENTS
                        </button>
                    </div>
                    
                    <!-- Sheet Preview -->
                    <div class="sheet-preview">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">
                            <span>üñ®Ô∏è</span> 6√ó4 Photo Sheet
                        </h3>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                            <strong>Standard 6√ó4 inch Photo Sheet</strong><br>
                            Contains 6 passport size photos (2√ó2 inch each)
                        </div>
                        
                        <div class="sheet-canvas-container">
                            <canvas id="sheetCanvas" width="1800" height="1200"></canvas>
                        </div>
                        
                        <div class="sheet-info">
                            <div style="margin-bottom: 10px; font-weight: bold;">üìê Sheet Specifications:</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: left;">
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">Sheet Size:</div>
                                    <div style="font-weight: bold;">6√ó4 inches</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">Photo Size:</div>
                                    <div style="font-weight: bold;">2√ó2 inches</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">DPI:</div>
                                    <div style="font-weight: bold;">300 DPI</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">Total Photos:</div>
                                    <div style="font-weight: bold;">6 Photos</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="process-btn" onclick="generatePhotoSheet()" style="margin-top: 20px;">
                            <span>üñ®Ô∏è</span> GENERATE & DOWNLOAD 6√ó4 SHEET
                        </button>
                        
                        <button class="control-btn" onclick="downloadSinglePhoto()" style="width: 100%; margin-top: 10px;">
                            üì• DOWNLOAD SINGLE PHOTO
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="address-box">
                    <h4 style="margin-bottom: 10px; color: #bbdefb;">üìå ‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø:</h4>
                    <p>147‡Æé, ‡Æï‡Æø‡Æ∞‡Øá‡Æü‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æ©‡Øç ‡Æ∞‡Øã‡Æü‡ØÅ,<br>
                       ‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æ™‡Ææ‡Æï‡ÆÆ‡Øç ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡ÆÆ‡Øç ‡Æé‡Æ§‡Æø‡Æ∞‡Æø‡Æ≤‡Øç,<br>
                       ‡Æ§‡ØÇ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æü‡Æø-628001</p>
                </div>
                
                <div class="contact-box">
                    <h4 style="margin-bottom: 10px; color: #bbdefb;">üìû ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ:</h4>
                    <p>‡Æö‡ØÜ‡Æ≤‡Øç: 98 43 23 23 24<br>
                       ‡Æö‡ØÜ‡Æ≤‡Øç: 88 70 23 23 32<br>
                       ‡Æö‡ØÜ‡Æ≤‡Øç: 95 85 33 43 65</p>
                    <p style="margin-top: 10px; font-size: 0.9em;">
                        Website: <a href="https://dhasscsc.github.io/online_service/" 
                                   style="color: #bbdefb; text-decoration: none;">
                                   dhasscsc.github.io/online_service/
                                 </a>
                    </p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                <p>¬© 2018 ‡Æ§‡Ææ‡Æ∏‡Øç ‡Æ™‡Øä‡Æ§‡ØÅ ‡Æö‡Øá‡Æµ‡Øà ‡ÆÆ‡Øà‡ÆØ‡ÆÆ‡Øç | ‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Ææ‡Æ®‡Æø‡Æ≤ ‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡ÆÖ‡Æô‡Øç‡Æï‡ØÄ‡Æï‡Ææ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ</p>
                <p style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">
                    PAN Card & Passport Photo Processing Software
                </p>
            </div>
        </footer>
    </div>
    
    <!-- Processing Modal -->
    <div class="modal" id="processingModal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon">‚è≥</div>
            <h3 id="modalTitle">Processing...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="modalMessage" style="margin-top: 15px;">Please wait while we process your images...</p>
        </div>
    </div>

    <script>
        // Global Variables
        let currentProvider = 'uti';
        let panPhotoImage = null;
        let panSignImage = null;
        let passportImage = null;
        let editorCanvas, editorCtx, sheetCanvas, sheetCtx;
        
        // PAN Providers Configuration
        const providers = {
            uti: {
                name: "UTI Infrastructure",
                photo: { width: 213, height: 213, dpi: 300 },
                signature: { width: 400, height: 200, dpi: 600 }
            },
            nsdl: {
                name: "NSDL e-Gov",
                photo: { width: 197, height: 276, dpi: 200 },
                signature: { width: 354, height: 157, dpi: 200 }
            },
            esevai: {
                name: "ESEVAI",
                photo: { width: 250, height: 250, dpi: 200 },
                signature: null // No signature required
            }
        };
        
        // Passport settings
        const passportSettings = {
            sheetWidth: 1800,  // 6 inches at 300 DPI
            sheetHeight: 1200, // 4 inches at 300 DPI
            photoWidth: 600,   // 2 inches at 300 DPI
            photoHeight: 600,  // 2 inches at 300 DPI
            dpi: 300,
            margin: 20,
            gap: 15
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize canvases
            editorCanvas = document.getElementById('editorCanvas');
            editorCtx = editorCanvas.getContext('2d');
            sheetCanvas = document.getElementById('sheetCanvas');
            sheetCtx = sheetCanvas.getContext('2d');
            
            // Set canvas sizes
            editorCanvas.width = 600;
            editorCanvas.height = 600;
            
            // Set default provider
            selectProvider('uti');
            
            // Draw initial sheet
            drawEmptySheet();
        });
        
        // Tab Switching
        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            if (tabName === 'pan') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('panTab').classList.add('active');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('passportTab').classList.add('active');
            }
        }
        
        // Provider Selection
        function selectProvider(provider) {
            currentProvider = provider;
            
            // Update provider cards
            document.querySelectorAll('.provider-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(`provider${provider.charAt(0).toUpperCase() + provider.slice(1)}`).classList.add('active');
            
            // Update displays
            const providerData = providers[provider];
            
            // Update photo display
            document.getElementById('photoSizeDisplay').textContent = 
                `${providerData.photo.width}√ó${providerData.photo.height} px`;
            document.getElementById('photoDpiDisplay').textContent = 
                `${providerData.photo.dpi} DPI`;
            
            // Update signature display or hide it
            const signatureSection = document.getElementById('signatureSection');
            if (providerData.signature) {
                signatureSection.style.display = 'block';
                document.getElementById('signSizeDisplay').textContent = 
                    `${providerData.signature.width}√ó${providerData.signature.height} px`;
                document.getElementById('signDpiDisplay').textContent = 
                    `${providerData.signature.dpi} DPI`;
            } else {
                signatureSection.style.display = 'none';
            }
        }
        
        // PAN Image Handlers
        function handlePanPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                panPhotoImage = new Image();
                panPhotoImage.onload = function() {
                    displayPanImage(panPhotoImage, 'panPhotoPreview');
                    showModal('Photo uploaded successfully!', 'success');
                };
                panPhotoImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function handlePanSignUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                panSignImage = new Image();
                panSignImage.onload = function() {
                    displayPanImage(panSignImage, 'panSignPreview');
                    showModal('Signature uploaded successfully!', 'success');
                };
                panSignImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function pastePanImage(type) {
            navigator.clipboard.read().then(clipboardItems => {
                for (const item of clipboardItems) {
                    const imageTypes = item.types.filter(type => type.startsWith('image/'));
                    if (imageTypes.length > 0) {
                        item.getType(imageTypes[0]).then(blob => {
                            const imageUrl = URL.createObjectURL(blob);
                            const img = new Image();
                            img.onload = function() {
                                if (type === 'photo') {
                                    panPhotoImage = img;
                                    displayPanImage(img, 'panPhotoPreview');
                                } else {
                                    panSignImage = img;
                                    displayPanImage(img, 'panSignPreview');
                                }
                                showModal(`${type} pasted from clipboard!`, 'success');
                            };
                            img.src = imageUrl;
                        });
                        break;
                    }
                }
            }).catch(err => {
                // Fallback to file upload
                if (type === 'photo') {
                    document.getElementById('panPhotoUpload').click();
                } else {
                    document.getElementById('panSignUpload').click();
                }
            });
        }
        
        function displayPanImage(img, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            const container = document.createElement('div');
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.justifyContent = 'center';
            container.style.overflow = 'hidden';
            
            img.style.maxWidth = '100%';
            img.style.maxHeight = '100%';
            img.style.objectFit = 'contain';
            
            container.appendChild(img);
            preview.appendChild(container);
        }
        
        function clearPanImage(type) {
            if (type === 'photo') {
                panPhotoImage = null;
                document.getElementById('panPhotoPreview').innerHTML = 
                    '<div style="color: #999; text-align: center;"><div style="font-size: 3em; margin-bottom: 10px;">üì∏</div><div>Photo will appear here</div></div>';
            } else {
                panSignImage = null;
                document.getElementById('panSignPreview').innerHTML = 
                    '<div style="color: #999; text-align: center;"><div style="font-size: 3em; margin-bottom: 10px;">‚úçÔ∏è</div><div>Signature will appear here</div></div>';
            }
        }
        
        function processPanImages() {
            if (!panPhotoImage) {
                showModal('Please upload a photo first!', 'error');
                return;
            }
            
            if (currentProvider !== 'esevai' && !panSignImage) {
                showModal('Please upload a signature!', 'error');
                return;
            }
            
            showProcessing('Processing PAN Images...');
            
            // Process photo
            setTimeout(() => {
                const provider = providers[currentProvider];
                
                // Create photo canvas
                const photoCanvas = document.createElement('canvas');
                photoCanvas.width = provider.photo.width;
                photoCanvas.height = provider.photo.height;
                const photoCtx = photoCanvas.getContext('2d');
                
                // Draw and resize photo
                photoCtx.drawImage(panPhotoImage, 0, 0, provider.photo.width, provider.photo.height);
                
                // Download photo
                downloadImage(photoCanvas, `PAN_Photo_${currentProvider.toUpperCase()}.jpg`);
                
                // Process signature if needed
                if (provider.signature && panSignImage) {
                    const signCanvas = document.createElement('canvas');
                    signCanvas.width = provider.signature.width;
                    signCanvas.height = provider.signature.height;
                    const signCtx = signCanvas.getContext('2d');
                    
                    // Convert to grayscale for signature
                    signCtx.drawImage(panSignImage, 0, 0, provider.signature.width, provider.signature.height);
                    
                    // Convert to black and white
                    const imageData = signCtx.getImageData(0, 0, provider.signature.width, provider.signature.height);
                    const data = imageData.data;
                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        const bw = avg > 128 ? 255 : 0;
                        data[i] = bw;     // red
                        data[i + 1] = bw; // green
                        data[i + 2] = bw; // blue
                    }
                    signCtx.putImageData(imageData, 0, 0);
                    
                    // Download signature
                    setTimeout(() => {
                        downloadImage(signCanvas, `PAN_Signature_${currentProvider.toUpperCase()}.jpg`);
                        hideModal();
                        showModal('PAN images processed successfully!', 'success');
                    }, 500);
                } else {
                    hideModal();
                    showModal('PAN photo processed successfully!', 'success');
                }
            }, 1000);
        }
        
        // Passport Photo Functions
        let currentBackground = 'white';
        let adjustments = {
            brightness: 0,
            contrast: 0,
            saturation: 0
        };
        let border = {
            thickness: 0,
            color: '#000000'
        };
        
        function handlePassportUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                passportImage = new Image();
                passportImage.onload = function() {
                    drawPassportImage();
                    showModal('Passport photo uploaded!', 'success');
                };
                passportImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function pastePassportImage() {
            navigator.clipboard.read().then(clipboardItems => {
                for (const item of clipboardItems) {
                    const imageTypes = item.types.filter(type => type.startsWith('image/'));
                    if (imageTypes.length > 0) {
                        item.getType(imageTypes[0]).then(blob => {
                            const imageUrl = URL.createObjectURL(blob);
                            passportImage = new Image();
                            passportImage.onload = function() {
                                drawPassportImage();
                                showModal('Photo pasted from clipboard!', 'success');
                            };
                            passportImage.src = imageUrl;
                        });
                        break;
                    }
                }
            }).catch(err => {
                document.getElementById('passportUpload').click();
            });
        }
        
        function changeBackgroundColor(color) {
            currentBackground = color;
            
            // Update active background
            document.querySelectorAll('.bg-color').forEach(bg => {
                bg.classList.remove('active');
            });
            event.target.classList.add('active');
            
            drawPassportImage();
        }
        
        function updateAdjustment(type) {
            const slider = document.getElementById(`${type}Slider`);
            const value = document.getElementById(`${type}Value`);
            
            adjustments[type] = parseInt(slider.value);
            value.textContent = `${adjustments[type]}%`;
            
            drawPassportImage();
        }
        
        function updateBorder() {
            border.thickness = parseInt(document.getElementById('borderThicknessSlider').value);
            border.color = document.getElementById('borderColorPicker').value;
            
            document.getElementById('borderThicknessValue').textContent = `${border.thickness} px`;
            
            drawPassportImage();
        }
        
        function resetAdjustments() {
            // Reset sliders
            document.getElementById('brightnessSlider').value = 0;
            document.getElementById('contrastSlider').value = 0;
            document.getElementById('saturationSlider').value = 0;
            document.getElementById('borderThicknessSlider').value = 0;
            document.getElementById('borderColorPicker').value = '#000000';
            
            // Reset values
            document.getElementById('brightnessValue').textContent = '0%';
            document.getElementById('contrastValue').textContent = '0%';
            document.getElementById('saturationValue').textContent = '0%';
            document.getElementById('borderThicknessValue').textContent = '0 px';
            
            // Reset variables
            adjustments = { brightness: 0, contrast: 0, saturation: 0 };
            border = { thickness: 0, color: '#000000' };
            currentBackground = 'white';
            
            // Reset background selection
            document.querySelectorAll('.bg-color').forEach(bg => {
                bg.classList.remove('active');
            });
            document.querySelector('.bg-color[data-color="white"]').classList.add('active');
            
            drawPassportImage();
        }
        
        function drawPassportImage() {
            if (!passportImage) return;
            
            // Clear canvas
            editorCtx.clearRect(0, 0, editorCanvas.width, editorCanvas.height);
            
            // Draw background
            if (currentBackground !== 'transparent') {
                editorCtx.fillStyle = currentBackground;
                editorCtx.fillRect(0, 0, editorCanvas.width, editorCanvas.height);
            }
            
            // Calculate image dimensions (maintain aspect ratio)
            const maxWidth = editorCanvas.width - (border.thickness * 2);
            const maxHeight = editorCanvas.height - (border.thickness * 2);
            
            let width = passportImage.width;
            let height = passportImage.height;
            
            // Calculate aspect ratio
            const aspectRatio = width / height;
            
            if (width > maxWidth) {
                width = maxWidth;
                height = width / aspectRatio;
            }
            
            if (height > maxHeight) {
                height = maxHeight;
                width = height * aspectRatio;
            }
            
            // Center the image
            const x = (editorCanvas.width - width) / 2;
            const y = (editorCanvas.height - height) / 2;
            
            // Save context for clipping
            editorCtx.save();
            
            // Create clipping path for rounded corners
            editorCtx.beginPath();
            editorCtx.roundRect(x, y, width, height, 10);
            editorCtx.clip();
            
            // Draw image
            editorCtx.drawImage(passportImage, x, y, width, height);
            
            // Restore context
            editorCtx.restore();
            
            // Apply filters (simulated)
            applyImageFilters(x, y, width, height);
            
            // Draw border
            if (border.thickness > 0) {
                editorCtx.strokeStyle = border.color;
                editorCtx.lineWidth = border.thickness;
                editorCtx.beginPath();
                editorCtx.roundRect(x, y, width, height, 10);
                editorCtx.stroke();
            }
        }
        
        function applyImageFilters(x, y, width, height) {
            // This is a simplified filter application
            // For production, use proper image processing
            const imageData = editorCtx.getImageData(x, y, width, height);
            const data = imageData.data;
            
            // Apply brightness
            if (adjustments.brightness !== 0) {
                const brightness = adjustments.brightness * 2.55; // Convert to 0-255
                for (let i = 0; i < data.length; i += 4) {
                    data[i] = clamp(data[i] + brightness);
                    data[i + 1] = clamp(data[i + 1] + brightness);
                    data[i + 2] = clamp(data[i + 2] + brightness);
                }
            }
            
            // Apply contrast (simplified)
            if (adjustments.contrast !== 0) {
                const contrast = (adjustments.contrast + 100) / 100;
                const factor = (contrast * contrast);
                for (let i = 0; i < data.length; i += 4) {
                    data[i] = clamp(((data[i] / 255 - 0.5) * factor + 0.5) * 255);
                    data[i + 1] = clamp(((data[i + 1] / 255 - 0.5) * factor + 0.5) * 255);
                    data[i + 2] = clamp(((data[i + 2] / 255 - 0.5) * factor + 0.5) * 255);
                }
            }
            
            editorCtx.putImageData(imageData, x, y);
        }
        
        function clamp(value) {
            return Math.max(0, Math.min(255, value));
        }
        
        function drawEmptySheet() {
            sheetCtx.fillStyle = 'white';
            sheetCtx.fillRect(0, 0, sheetCanvas.width, sheetCanvas.height);
            
            // Draw grid lines
            sheetCtx.strokeStyle = '#e0e0e0';
            sheetCtx.lineWidth = 1;
            
            // Vertical lines
            for (let i = 1; i < 3; i++) {
                const x = (sheetCanvas.width / 3) * i;
                sheetCtx.beginPath();
                sheetCtx.moveTo(x, 0);
                sheetCtx.lineTo(x, sheetCanvas.height);
                sheetCtx.stroke();
            }
            
            // Horizontal line
            sheetCtx.beginPath();
            sheetCtx.moveTo(0, sheetCanvas.height / 2);
            sheetCtx.lineTo(sheetCanvas.width, sheetCanvas.height / 2);
            sheetCtx.stroke();
            
            // Draw placeholder text
            sheetCtx.fillStyle = '#999';
            sheetCtx.font = 'bold 40px Arial';
            sheetCtx.textAlign = 'center';
            sheetCtx.textBaseline = 'middle';
            
            for (let row = 0; row < 2; row++) {
                for (let col = 0; col < 3; col++) {
                    const x = (col * sheetCanvas.width / 3) + (sheetCanvas.width / 6);
                    const y = (row * sheetCanvas.height / 2) + (sheetCanvas.height / 4);
                    
                    sheetCtx.fillText('2"√ó2"', x, y);
                    sheetCtx.font = '20px Arial';
                    sheetCtx.fillText('Passport Size', x, y + 40);
                }
            }
        }
        
        function generatePhotoSheet() {
            if (!passportImage) {
                showModal('Please upload a photo first!', 'error');
                return;
            }
            
            showProcessing('Generating 6√ó4 Photo Sheet...');
            
            setTimeout(() => {
                // Clear sheet
                sheetCtx.fillStyle = 'white';
                sheetCtx.fillRect(0, 0, sheetCanvas.width, sheetCanvas.height);
                
                // Calculate photo dimensions for sheet
                const photoWidth = passportSettings.photoWidth;
                const photoHeight = passportSettings.photoHeight;
                const margin = passportSettings.margin;
                const gap = passportSettings.gap;
                
                // Create temporary canvas for single photo
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = photoWidth;
                tempCanvas.height = photoHeight;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Draw single photo with current settings
                drawPhotoToCanvas(tempCtx, tempCanvas.width, tempCanvas.height);
                
                // Arrange 6 copies on sheet
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 3; col++) {
                        const x = col * (photoWidth + gap) + margin;
                        const y = row * (photoHeight + gap) + margin;
                        
                        sheetCtx.drawImage(tempCanvas, x, y);
                    }
                }
                
                // Add cutting guides
                sheetCtx.strokeStyle = '#000';
                sheetCtx.setLineDash([5, 5]);
                sheetCtx.lineWidth = 1;
                
                // Vertical cutting lines
                sheetCtx.beginPath();
                sheetCtx.moveTo(sheetCanvas.width / 3, 0);
                sheetCtx.lineTo(sheetCanvas.width / 3, sheetCanvas.height);
                sheetCtx.moveTo((sheetCanvas.width / 3) * 2, 0);
                sheetCtx.lineTo((sheetCanvas.width / 3) * 2, sheetCanvas.height);
                sheetCtx.stroke();
                
                // Horizontal cutting line
                sheetCtx.beginPath();
                sheetCtx.moveTo(0, sheetCanvas.height / 2);
                sheetCtx.lineTo(sheetCanvas.width, sheetCanvas.height / 2);
                sheetCtx.stroke();
                
                sheetCtx.setLineDash([]);
                
                // Download sheet
                setTimeout(() => {
                    downloadImage(sheetCanvas, 'Passport_Sheet_6x4.jpg');
                    hideModal();
                    showModal('6√ó4 photo sheet generated!', 'success');
                }, 500);
                
            }, 1000);
        }
        
        function drawPhotoToCanvas(ctx, width, height) {
            // Draw background
            if (currentBackground !== 'transparent') {
                ctx.fillStyle = currentBackground;
                ctx.fillRect(0, 0, width, height);
            }
            
            // Calculate image dimensions
            const imgWidth = passportImage.width;
            const imgHeight = passportImage.height;
            const aspectRatio = imgWidth / imgHeight;
            
            let drawWidth = width;
            let drawHeight = height;
            
            if (imgWidth > imgHeight) {
                drawHeight = drawWidth / aspectRatio;
            } else {
                drawWidth = drawHeight * aspectRatio;
            }
            
            // Center the image
            const x = (width - drawWidth) / 2;
            const y = (height - drawHeight) / 2;
            
            // Draw image
            ctx.save();
            ctx.beginPath();
            ctx.roundRect(x, y, drawWidth, drawHeight, 10);
            ctx.clip();
            ctx.drawImage(passportImage, x, y, drawWidth, drawHeight);
            ctx.restore();
            
            // Draw border
            if (border.thickness > 0) {
                ctx.strokeStyle = border.color;
                ctx.lineWidth = border.thickness;
                ctx.beginPath();
                ctx.roundRect(x, y, drawWidth, drawHeight, 10);
                ctx.stroke();
            }
        }
        
        function downloadSinglePhoto() {
            if (!passportImage) {
                showModal('Please upload a photo first!', 'error');
                return;
            }
            
            const canvas = document.createElement('canvas');
            canvas.width = passportSettings.photoWidth;
            canvas.height = passportSettings.photoHeight;
            const ctx = canvas.getContext('2d');
            
            drawPhotoToCanvas(ctx, canvas.width, canvas.height);
            downloadImage(canvas, 'Passport_Photo_2x2.jpg');
        }
        
        // Utility Functions
        function downloadImage(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function showProcessing(message) {
            document.getElementById('modalTitle').textContent = message;
            document.getElementById('modalMessage').textContent = 'Please wait...';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('processingModal').style.display = 'flex';
            
            // Animate progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                document.getElementById('progressFill').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 20);
        }
        
        function showModal(message, type) {
            const modal = document.getElementById('processingModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = message;
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('modalMessage').textContent = type === 'success' ? 
                'Operation completed successfully!' : 'Please check your input.';
            
            modalIcon.textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚è≥';
            modal.style.display = 'flex';
            
            setTimeout(hideModal, 2000);
        }
        
        function hideModal() {
            document.getElementById('processingModal').style.display = 'none';
        }
    </script>
</body>
</html>